<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>不听话的兔子君 - 那破云的光终会洒落，将有人迎向你的身侧</title><meta name="author" content="naughtyrabbit"><meta name="copyright" content="naughtyrabbit"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="记录生活，记录成长">
<meta property="og:type" content="website">
<meta property="og:title" content="不听话的兔子君">
<meta property="og:url" content="https://naughtyrabbit.github.io/page/3/index.html">
<meta property="og:site_name" content="不听话的兔子君">
<meta property="og:description" content="记录生活，记录成长">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://e.im5i.com/2021/10/12/PEw4Y.jpg">
<meta property="article:author" content="naughtyrabbit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://e.im5i.com/2021/10/12/PEw4Y.jpg"><link rel="shortcut icon" href="/img/head.jpg"><link rel="canonical" href="https://naughtyrabbit.github.io/page/3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '不听话的兔子君',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-11-02 10:35:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="不听话的兔子君" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://e.im5i.com/2021/10/12/PEw4Y.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">不听话的兔子君</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/02/23/pytorch-learning-adv-yolov5-obb-2/" title="yolov5+csl旋转目标检测代码解析2">     <img class="post_bg" src="https://m1.im5i.com/2022/08/19/UcP3AA.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov5+csl旋转目标检测代码解析2"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/23/pytorch-learning-adv-yolov5-obb-2/" title="yolov5+csl旋转目标检测代码解析2">yolov5+csl旋转目标检测代码解析2</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-23T11:03:11.000Z" title="发表于 2022-02-23 19:03:11">2022-02-23</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录学习yolov5+csl旋转目标检测的原理，主要是探究代码中如何得到theta/gauss_theta的target。参考知乎 略略略 https://zhuanlan.zhihu.com/p/358441134； yangxue https://zhuanlan.zhihu.com/p/111493759


一、debug记录
  经过dataloader之后的数据格式如图，cls已经转化为id。此时仍是原本的表示方法。

  在plot_labels里面会有完整的标签格式转换以及高斯窗的csl方法，但是这个函数并没有返回


  即最后一个参数为True时，使用csl，并且采用高斯窗函数，csl部分代码是直接从yangxue大佬那里拿来用的。
def poly2rbox(polys, num_cls_thata=180, radius=6.0, use_pi=False, use_gaussian=False):
    &quot;&quot;&quot;
    Trans poly format to rbox format.
    Args:
       ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/02/17/pytorch-learning-adv-yolov5-obb/" title="yolov5+csl旋转目标检测代码解析1">     <img class="post_bg" src="https://m1.im5i.com/2022/08/17/UctUeW.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov5+csl旋转目标检测代码解析1"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/17/pytorch-learning-adv-yolov5-obb/" title="yolov5+csl旋转目标检测代码解析1">yolov5+csl旋转目标检测代码解析1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-17T01:50:17.000Z" title="发表于 2022-02-17 09:50:17">2022-02-17</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录学习yolov5+csl旋转目标检测的原理，主要是代码中损失函数部分的细节。参考知乎 略略略 https://zhuanlan.zhihu.com/p/358441134； yangxue https://zhuanlan.zhihu.com/p/111493759


一、Define criteria
  源码位置：utils/loss.py
# Define criteria
BCEcls = nn.BCEWithLogitsLoss(pos_weight=torch.tensor([h['cls_pw']], device=device))
BCEtheta = nn.BCEWithLogitsLoss(pos_weight=torch.tensor([h['theta_pw']], device=device))
BCEobj = nn.BCEWithLogitsLoss(pos_weight=torch.tensor([h['obj_pw']], device=device))
# BCEtheta是相对于yolov5自加的，csl基于角度分类的部分。

   ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/02/02/pytorch-learning-adv-yolov5-2/" title="yolov5目标检测原理探究（2）">     <img class="post_bg" src="https://m1.im5i.com/2022/08/18/UcH13y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov5目标检测原理探究（2）"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/02/pytorch-learning-adv-yolov5-2/" title="yolov5目标检测原理探究（2）">yolov5目标检测原理探究（2）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-02T13:13:45.000Z" title="发表于 2022-02-02 21:13:45">2022-02-02</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录学习yolov5的原理，包括一些代码细节以及代码的复现。参考薛定谔的AI。


一、正样本采样细节
  相关源代码位置：utils/loss.py/class ComputeLoss/def build_targets(self, p, targets)
  对于如图所示的8个目标边框的中心点：

  在代码中的如图位置会对目标边框的grid作正采样：

  第一部分经过筛选之后得到如图结果（灰色），j,k是所得的布尔矩阵;l,m是以tensor右上角为原点之后作同样的筛选得到。

  将所得点作对应的偏移：

  最终所得如图所示；其中深灰色即原ground truth对应边框数据，绿色为补充正样本边框数据。

二、损失计算细节
  相关源代码位置：utils/loss.py/class ComputeLoss

  如图是GIOU，前两点比较好理解，第三点“偏离趋势度量能力”是左下角图2，如果此时采用传统IOU则两者数值都是0，则无法对训练过程作出很好的指导作用；当然当目标框和预测框处于水平或者垂直位置时，GIOU则退化成了传统的IOU，不具备优势，为了解决这一问题， ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/26/pytorch-learning-adv-yolov5/" title="yolov5目标检测原理探究（1）">     <img class="post_bg" src="https://m1.im5i.com/2022/08/18/UcH3bX.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov5目标检测原理探究（1）"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/26/pytorch-learning-adv-yolov5/" title="yolov5目标检测原理探究（1）">yolov5目标检测原理探究（1）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-26T05:56:57.000Z" title="发表于 2022-01-26 13:56:57">2022-01-26</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录学习yolov5w的原理，包括一些代码细节以及代码的复现。参考薛定谔的AI。


一、数据增强
  源码中位置：train.py-&gt;create_dataloader-&gt;LoadImagesAndLabels;
  参数配置：data/hyps/hyp.scratch.yaml
rectangular：同个batch里做rectangle宽高等比变换，加快训练
hsv h：0.015#image HSV-Hue augmentation（fraction），色调
hsv_s：0.7#image HSV-Saturation augmentation（fraction），饱和度
hsv_v：0.4#image HSV-Value augmentation（fraction），曝光度
degrees：0.0#image rotation（+/-deg），旋转
translate：0.1#image translation（+/-fraction），平移
scale：0.5#image scale（+/-gain），缩放
shear：0.0#image shear（ ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/19/pytorch-learning-adv-yolov3/" title="yolov3目标检测原理探究">     <img class="post_bg" src="https://m1.im5i.com/2022/08/18/UcHR8W.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov3目标检测原理探究"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/19/pytorch-learning-adv-yolov3/" title="yolov3目标检测原理探究">yolov3目标检测原理探究</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-19T07:11:06.000Z" title="发表于 2022-01-19 15:11:06">2022-01-19</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录学习yolov3的原理，主要是对yolov3论文的精读。参考：同济子豪兄

  
一、骨干网络 DarkNet53
  yolov3的骨干网络（backbone）从yolov2的darknet19改成了darknet53，如图：前面的1x/2x代表重复这个block。输入可以是不同尺度的图像，但是必须是32的倍数，因为最后会对feature map进行32，16和8的下采样。然后输送给检测部分。

二、网络结构
255 &#x3D; 3 x 85(80 + 5)
每个grid cell有三个anchor；
每个anchor有(x, y, w, h, objectiveness)五个基本参数，加上coco数据集的80个类别的条件概率信息（在假设这个框的是物体的情况下，它是猫&#x2F;狗&#x2F;...的概率）。
而前面则是grid cell的数量，13x13个，26x26个

  在yolov3中输出是三个尺度的，而显然，某个物体可能同时落在三个尺度的三个grid cell所产生的9个anchor，那此时，将由与ground truth的IOU最大的anchor去作拟合 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/18/pytorch-learning-adv-yolov2/" title="yolov2目标检测原理探究">     <img class="post_bg" src="https://m1.im5i.com/2022/08/17/UcotTC.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov2目标检测原理探究"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/18/pytorch-learning-adv-yolov2/" title="yolov2目标检测原理探究">yolov2目标检测原理探究</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-18T04:47:34.000Z" title="发表于 2022-01-18 12:47:34">2022-01-18</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录学习yolov2的原理，主要是对yolov2论文的精读。参考：同济子豪兄

  
一、Better
1. Batch Normalization
  如图，BN层会把输入进行一个减去均值，除以方差的操作。得到的结果就是把输入集中在0附近，这么做的好处是之后的一些激活函数，比如sigmoid函数，他在0附近是非饱和区。在更大的地方是饱和区，会出现梯度消失，难以训练的情况。
  在训练阶段，比如batch size是32，某层的神经元会输出32个相应值，对这32个响应值求均值，标准差，再作归一化，把归一化后的响应值乘γ再加上β（对归一化结果作一个线性输出，尽可能减少归一化带来的信息损失），每个神经元都训练一组γ，β。
  测试阶段的均值，方差用训练阶段所得结果处理得到，此时的BN层是相当于作了一个线性变换。

2. High Resolution Classifier
  aka:高分辨率分类器。先在224x224的ImageNet上训练，再在448x448上训练。
3. Anchor
  在yolov1中每个grid所生成的两个bbox都是随机的，然后根据哪个和目标的IOU ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/15/pytorch-learning-adv-yolov1/" title="yolov1目标检测原理探究">     <img class="post_bg" src="https://m1.im5i.com/2022/08/17/UcoFSx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov1目标检测原理探究"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/15/pytorch-learning-adv-yolov1/" title="yolov1目标检测原理探究">yolov1目标检测原理探究</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-15T07:05:02.000Z" title="发表于 2022-01-15 15:05:02">2022-01-15</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要记录一下学习目标检测的原理到yolov1的原理，是理解之后版本的基础。参考：同济子豪兄

  
一、目标检测
  如图，目标检测包括了分类以及各类别目标的定位

  分割（segmentation）包括了语义分割和实例分割，前者对像素进行按类别分割，后者是把同一类别的不同实例作分割。

1. one-stage / two-stage detector
  两阶段检测模型就是先从图像提取若干候选框，再逐一地对这些候选框进行分类、甄别等任务，最后得出结果；与此相对，单阶段检测模型直接把全图喂给算法，然后出结果，是一个统一的端到端（end to end）的过程。yolo是典型的单阶段模型。一般而言，前者比较准确而速度相对慢，后者可能效果差一些，但是速度快，yolo尤以快速闻名（yolov1时对小目标，密集目标的检测效果相对差一些，经过发展，目前的效果已经非常不错）。

  两阶段检测模型的典型RCNN，发展到Fast-RCNN最主要的改变是首先不作候选框的提取，先把整张图喂给卷积层，提取出一个共同的特征，然后在重复之前RCNN的操作。这能够一定程度上提高速度。
  然而两阶段检测 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/09/pytorch-learning-adv-autoencoder/" title="pytorch学习笔记-高阶篇（无监督学习）">     <img class="post_bg" src="https://m1.im5i.com/2022/08/19/UqDdUW.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pytorch学习笔记-高阶篇（无监督学习）"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/09/pytorch-learning-adv-autoencoder/" title="pytorch学习笔记-高阶篇（无监督学习）">pytorch学习笔记-高阶篇（无监督学习）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-09T05:35:58.000Z" title="发表于 2022-01-09 13:35:58">2022-01-09</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要是记录无监督学习相关知识


一、监督学习
  像之前的分类和回归问题，比如分类问题，要提前人工写好label告诉它这张图片里是数字9，但是这种labeling实际上可能非常耗时耗力，现实生活中存在着大量没有labeling的数据，如何利用这些数据是无监督学习一直想要做的。

二、auto-encoder
  无监督学习的目标的重建他自己

三、无监督学习的训练
  无监督学习的损失函数和监督学习一样，不管是Crossentropy或者均方差等都可以，训练方法一致。
四、autoencoder实战
1. autoencoder类
  同样继承自nn.module,里面有encoder和decoder两大部分
import torch
from torch import nn


class AutoEncoder(nn.Module):
    def __init__(self):
        super(AutoEncoder, self).__init__()

        # [b, 784] =&gt; [b, 20]
        self.encode ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/03/pytorch-learning-adv-CNNpra3/" title="pytorch学习笔记-高阶篇（卷积神经网络实战3）">     <img class="post_bg" src="https://m1.im5i.com/2022/08/17/Uco1ua.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pytorch学习笔记-高阶篇（卷积神经网络实战3）"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/03/pytorch-learning-adv-CNNpra3/" title="pytorch学习笔记-高阶篇（卷积神经网络实战3）">pytorch学习笔记-高阶篇（卷积神经网络实战3）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-03T02:52:02.000Z" title="发表于 2022-01-03 10:52:02">2022-01-03</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要是卷积神经网络的实战，网络结构主要是resnet,数据集用的是自建pokemon数据集，包含了整个流程，从数据集的处理，训练，测试等。


一、加载数据
数据预处理

Image Resize
·224×224 for ResNet18
Data Argumentation
·Rotate
·Crop
Normalize
·Mean,std
ToTensor

import torch
import os
import glob
import random
import csv
from torch.utils.data import Dataset
from torch.utils.data import DataLoader
from torchvision import transforms
from PIL import Image


class Pokemon(Dataset):
    def __init__(self, root, resize, mode):
        &quot;&quot;&quot;
        Args:
         ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/02/pytorch-learning-adv-RNNprob/" title="pytorch学习笔记-高阶篇（RNN训练难题）">     <img class="post_bg" src="https://m1.im5i.com/2022/08/17/UcoKNY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pytorch学习笔记-高阶篇（RNN训练难题）"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/02/pytorch-learning-adv-RNNprob/" title="pytorch学习笔记-高阶篇（RNN训练难题）">pytorch学习笔记-高阶篇（RNN训练难题）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-02T02:28:53.000Z" title="发表于 2022-01-02 10:28:53">2022-01-02</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/pytorch/">pytorch</a></span></div><div class="content">
本篇主要是说明RNN在训练过程中会遇到的一些问题，包括梯度弥散和梯度爆炸。以及怎么用改进的LSTM来解决

  
  梯度弥散和梯度爆炸简单理解就是0.99^100和1.01^100这种概念。
一、梯度爆炸

  如图所示，在正常的梯度下降方向，到达某个位置的时候，一个微小的动作都会让梯度偏离原来的路线。为此，我们可以设置一个阈值，当大于这个阈值的时候，就硬性地把它扳回原来的方向。
loss = criteon(output, y)
model.zero_grad()
loss.backward()
for p in module,parameters():
    print(p.grad.norm())
    # 最大值设置为10，会把模限制在10以内
    torch.nn.utils.clip_grad_norm_(p, 10)
optimizer.step()

一、梯度弥散=&gt;LSTM

  如图所示。对此，提出了改进的LSTM网络,与RNN的short term memery相比，不仅改善了梯度弥散，还延长了语境记忆的长度。所以称为long short ter ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/#content-inner">9</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://e.im5i.com/2021/10/12/PEw4Y.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">naughtyrabbit</div><div class="author-info__description">记录生活，记录成长</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/naughtyrabbit"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/naughtyrabbit" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/02/linux-myshell/" title="用fork,exec,wait实现一个自己的shell"><img src="https://m1.im5i.com/2022/08/17/UcoXqB.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用fork,exec,wait实现一个自己的shell"/></a><div class="content"><a class="title" href="/2022/11/02/linux-myshell/" title="用fork,exec,wait实现一个自己的shell">用fork,exec,wait实现一个自己的shell</a><time datetime="2022-11-02T01:06:35.000Z" title="发表于 2022-11-02 09:06:35">2022-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/24/FPGA-SEM-intro/" title="FPGA_软错误缓解_介绍"><img src="https://m1.im5i.com/2022/08/17/UctYoD.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FPGA_软错误缓解_介绍"/></a><div class="content"><a class="title" href="/2022/08/24/FPGA-SEM-intro/" title="FPGA_软错误缓解_介绍">FPGA_软错误缓解_介绍</a><time datetime="2022-08-24T08:51:07.000Z" title="发表于 2022-08-24 16:51:07">2022-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/23/FPGA-DFX-RTLprj/" title="FPGA_动态功能切换_DFX RTL工程流程"><img src="https://m1.im5i.com/2022/08/19/UcPqFo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FPGA_动态功能切换_DFX RTL工程流程"/></a><div class="content"><a class="title" href="/2022/08/23/FPGA-DFX-RTLprj/" title="FPGA_动态功能切换_DFX RTL工程流程">FPGA_动态功能切换_DFX RTL工程流程</a><time datetime="2022-08-23T01:37:15.000Z" title="发表于 2022-08-23 09:37:15">2022-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/22/private-blog-1/" title="私人日记-1"><img src="https://m1.im5i.com/2022/08/19/UqDdUW.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="私人日记-1"/></a><div class="content"><a class="title" href="/2022/08/22/private-blog-1/" title="私人日记-1">私人日记-1</a><time datetime="2022-08-22T14:26:24.000Z" title="发表于 2022-08-22 22:26:24">2022-08-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/21/poem-2022-8-21/" title="兔言兔语——2"><img src="https://m1.im5i.com/2022/08/19/UcPSYf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="兔言兔语——2"/></a><div class="content"><a class="title" href="/2022/08/21/poem-2022-8-21/" title="兔言兔语——2">兔言兔语——2</a><time datetime="2022-08-21T14:21:03.000Z" title="发表于 2022-08-21 22:21:03">2022-08-21</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DFX/"><span class="card-category-list-name">DFX</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/TVM/"><span class="card-category-list-name">TVM</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/VHDL/"><span class="card-category-list-name">VHDL</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Vitis-AI/"><span class="card-category-list-name">Vitis-AI</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/hls/"><span class="card-category-list-name">hls</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/linux/"><span class="card-category-list-name">linux</span><span class="card-category-list-count">15</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/markdown/"><span class="card-category-list-name">markdown</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/pytorch/"><span class="card-category-list-name">pytorch</span><span class="card-category-list-count">43</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/DFX/" style="font-size: 1.18em; color: #999ca1">DFX</a> <a href="/tags/FIFO/" style="font-size: 1.1em; color: #999">FIFO</a> <a href="/tags/FPGA/" style="font-size: 1.26em; color: #999fa8">FPGA</a> <a href="/tags/Linux%E4%BF%A1%E5%8F%B7%E6%9C%BA%E5%88%B6/" style="font-size: 1.1em; color: #999">Linux信号机制</a> <a href="/tags/MQTT%E5%8D%8F%E8%AE%AE/" style="font-size: 1.1em; color: #999">MQTT协议</a> <a href="/tags/TVM/" style="font-size: 1.26em; color: #999fa8">TVM</a> <a href="/tags/Vitis-AI/" style="font-size: 1.1em; color: #999">Vitis-AI</a> <a href="/tags/exit-%E5%87%BD%E6%95%B0/" style="font-size: 1.1em; color: #999">_exit()函数</a> <a href="/tags/exec/" style="font-size: 1.1em; color: #999">exec()</a> <a href="/tags/exit-%E5%87%BD%E6%95%B0/" style="font-size: 1.1em; color: #999">exit()函数</a> <a href="/tags/fcntl-%E5%87%BD%E6%95%B0/" style="font-size: 1.1em; color: #999">fcntl()函数</a> <a href="/tags/fork/" style="font-size: 1.1em; color: #999">fork()</a> <a href="/tags/fork-%E5%87%BD%E6%95%B0/" style="font-size: 1.1em; color: #999">fork()函数</a> <a href="/tags/freopen-%E5%87%BD%E6%95%B0/" style="font-size: 1.1em; color: #999">freopen()函数</a> <a href="/tags/hls%E5%AD%A6%E4%B9%A0/" style="font-size: 1.34em; color: #99a3b0">hls学习</a> <a href="/tags/index/" style="font-size: 1.1em; color: #999">index</a> <a href="/tags/inet-pton/" style="font-size: 1.1em; color: #999">inet_pton</a> <a href="/tags/pytorch%E5%AD%A6%E4%B9%A0/" style="font-size: 1.5em; color: #99a9bf">pytorch学习</a> <a href="/tags/select-%E5%87%BD%E6%95%B0/" style="font-size: 1.26em; color: #999fa8">select()函数</a> <a href="/tags/socket/" style="font-size: 1.18em; color: #999ca1">socket</a> <a href="/tags/tcp-ip/" style="font-size: 1.1em; color: #999">tcp/ip</a> <a href="/tags/tensor/" style="font-size: 1.1em; color: #999">tensor</a> <a href="/tags/udp/" style="font-size: 1.1em; color: #999">udp</a> <a href="/tags/wait/" style="font-size: 1.1em; color: #999">wait()</a> <a href="/tags/yolo/" style="font-size: 1.42em; color: #99a6b7">yolo</a> <a href="/tags/%E4%B8%89%E6%80%81%E9%97%A8/" style="font-size: 1.1em; color: #999">三态门</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/" style="font-size: 1.18em; color: #999ca1">个人随笔</a> <a href="/tags/%E4%BA%A4%E5%8F%89%E7%86%B5/" style="font-size: 1.1em; color: #999">交叉熵</a> <a href="/tags/%E4%BF%A1%E5%8F%B7%E5%8F%91%E9%80%81%E5%87%BD%E6%95%B0kill/" style="font-size: 1.1em; color: #999">信号发送函数kill()</a> <a href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/" style="font-size: 1.1em; color: #999">信号量</a> <a href="/tags/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/" style="font-size: 1.1em; color: #999">共享内存</a> <a href="/tags/%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/" style="font-size: 1.1em; color: #999">分类问题</a> <a href="/tags/%E5%9B%9E%E5%BD%92%E9%97%AE%E9%A2%98/" style="font-size: 1.1em; color: #999">回归问题</a> <a href="/tags/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/" style="font-size: 1.1em; color: #999">守护进程</a> <a href="/tags/%E5%AE%9E%E6%88%98/" style="font-size: 1.34em; color: #99a3b0">实战</a> <a href="/tags/%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95/" style="font-size: 1.1em; color: #999">实验记录</a> <a href="/tags/%E5%BA%95%E5%B1%82IO/" style="font-size: 1.1em; color: #999">底层IO</a> <a href="/tags/%E6%97%A0%E5%90%8D%E7%AE%A1%E9%81%93/" style="font-size: 1.1em; color: #999">无名管道</a> <a href="/tags/%E6%9C%89%E5%90%8D%E7%AE%A1%E9%81%93/" style="font-size: 1.18em; color: #999ca1">有名管道</a> <a href="/tags/%E6%A0%87%E5%87%86IO/" style="font-size: 1.1em; color: #999">标准IO</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/12/"><span class="card-archive-list-date">十二月 2021</span><span class="card-archive-list-count">24</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">八月 2021</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">85</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-11-02T02:35:10.094Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By naughtyrabbit</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>